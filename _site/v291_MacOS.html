<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="/assets/css/style.css?v=bdaac666e5c51395ce4058c17cb7a09f373d172b">
    <link rel="stylesheet" type="text/css" href="/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>TBD | Thermal Bridging &amp; Derating</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="TBD" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Thermal Bridging &amp; Derating" />
<meta property="og:description" content="Thermal Bridging &amp; Derating" />
<link rel="canonical" href="http://localhost:4000/v291_MacOS.html" />
<meta property="og:url" content="http://localhost:4000/v291_MacOS.html" />
<meta property="og:site_name" content="TBD" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="TBD" />
<script type="application/ld+json">
{"@type":"WebPage","headline":"TBD","description":"Thermal Bridging &amp; Derating","url":"http://localhost:4000/v291_MacOS.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>TBD</h1>
          <h2>Thermal Bridging & Derating</h2>
        </header>
        <section id="downloads" class="clearfix">
          
          <a href="https://github.com/rd2/tbd/releases/download/v2.2.1/tbd.zip" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/rd2/tbd/releases/download/v2.2.1/tbd.tar.gz" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          
	
        </section>
        <hr>
        <section id="main_content">
          <p><em>We reiterate that energy modellers simply interested in using the TBD OpenStudio measure can either download the latest <a href="https://github.com/rd2/tbd/releases">release</a> or access the measure via NREL’s <a href="https://bcl.nrel.gov">BCL</a> … search for “bridging” or “rd2”.</em></p>

<p><em>Those instead interested in exploring/tweaking the source code (cloned or forked versions of TBD) can follow the Windows or MacOS Ruby setup described in TBD’s <a href="https://github.com/rd2/tbd#readme">README</a>.</em></p>

<p><em>The MacOS instructions below specifically target (older) Ruby v2.2.5 environments, needed for developing OpenStudio <a href="https://github.com/NREL/OpenStudio/releases/tag/v2.9.1">v2.9.1</a> measures - the most up-to-date version that remains <a href="https://github.com/NREL/OpenStudio/wiki/OpenStudio-SDK-Version-Compatibility-Matrix">compatible</a> with SketchUp 2017. Although TBD (and Topolys) are systematically tested against updated OpenStudio versions (v2.9.1 onwards), the following Ruby v2.2.5 setup is no longer tested or maintained. Nonetheless, it may be of some help for the more adventurous of you.</em></p>

<h2 id="v291-macos-instructions">v2.9.1 MacOS Instructions</h2>
<p><em>tested Catalina 10.15.4 up to Big Sur 11.4</em></p>

<p>OpenStudio v2.9.1 measures require Ruby v2.2.5, which is several iterations behind the default Ruby v2.6 version available on any recently-purchased Mac. Although it is common to develop/test using more than one Ruby version, some effort is nonetheless required for older vintages: v2.2.5 is no longer officially supported, it requires the deprecated OpenSSL-1.0 (not 1.1), etc. To help Mac users (and potentially Linux users as well), the following steps are recommended (although architecture-specific tweaks may be required).</p>

<p>From a Terminal, install <a href="https://brew.sh/index">Homebrew</a> - nice for package distribution and management. With a few tweaks, it will handle most package downloads, dependencies, etc. Using Homebrew, install OpenSSL-1.0, and then <em>rbenv</em> (which allows users to manage multiple Ruby versions). One way of doing it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew install rbenv/tap/openssl@1.0
</code></pre></div></div>

<p>By <em>tapping</em>, Homebrew provides a way to access third-party repositories that are no longer officially supported by Homebrew, like Ruby v2.2.5 and OpenSSL-1.0. The above instruction tells Homebrew to install compatible versions of OpenSSL-1.0 with <em>rbenv</em> (e.g. 1.0.2t, 1.0.2u).</p>

<p>Next, ensure that Homebrew and <em>rbenv</em> use OpenSSL-1.0 for future, local Ruby development. Edit (or create) a user’s local <em>~/.zshrc</em> file (instructions here are provided for zsh, the default macOS Terminal shell interface - bash users: adapt!), by pasting-in the following:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eval "$(rbenv init - zsh)"
export PATH="/usr/local/opt/openssl@1.0/bin:$PATH"
export LDFLAGS="-L/usr/local/opt/openssl@1.0/lib"
export CPPFLAGS="-I/usr/local/opt/openssl@1.0/include"
export PKG_CONFIG_PATH="/usr/local/opt/openssl@1.0/lib/pkgconfig"
export RUBY_CONFIGURE_OPTS="--with-openssl-dir=$(brew --prefix openssl@1.0)"
</code></pre></div></div>

<p>There’s probably more there than necessary, but it should do the trick for the next few steps, and/or for future work. Quit the Terminal and start a new one, or simply <em>source</em> the zshrc file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source ~/.zshrc
</code></pre></div></div>

<p>Make sure the right OpenSSL version is recognized, and then instruct Homebrew to switch over to it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl version
brew switch openssl 1.0.2t
</code></pre></div></div>

<p>… or whatever Openssl 1.0 version was installed, e.g. 1.0.2u. Then install <em>ruby-build</em>, <em>rbenv</em> and finally Ruby v2.2.5:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew install ruby-build
brew install rbenv
rbenv install 2.2.5
</code></pre></div></div>

<p>Install a compatible version of <a href="https://bundler.io">bundler</a>, great for managing Ruby gems and dependencies:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem install bundler -v 1.17.3
</code></pre></div></div>
<p>In some cases, (temporarily) switching over to an insecure <code class="language-plaintext highlighter-rouge">http</code> connection to rubygems.org (instead of the default <code class="language-plaintext highlighter-rouge">https</code>) may be required:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem source -r https://rubygems.org/
gem source -a http://rubygems.org/
gem install bundler -v 1.17.3
gem source -r http://rubygems.org/
gem source -a https://rubygems.org/
</code></pre></div></div>

<p>In the Terminal, check the Ruby version:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ruby -v
</code></pre></div></div>

<p>… should still report the current Ruby version used by macOS (e.g. <code class="language-plaintext highlighter-rouge">system</code> or <code class="language-plaintext highlighter-rouge">2.6</code>). To ensure Ruby v2.2.5 is used for developing OpenStudio v2.9.1-compatible measures, instruct <em>rbenv</em> to use Ruby v2.2.5 <em>locally</em> within a user’s chosen directory (e.g. “sandbox291”):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir ~/Documents/sandbox291
cd ~/Documents/sandbox291
rbenv local 2.2.5
ruby -v
</code></pre></div></div>

<p>… should now report <code class="language-plaintext highlighter-rouge">2.2.5</code> as the local Ruby version, to be used by default for anything under the “sandbox291” directory tree. To ensure both Ruby versions are operational and safe, run the following checkup twice - once from a user’s home (or ~/), then from within e.g., “sandbox291”:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/
ruby -ropen-uri -e 'eval open("https://git.io/vQhWq").read'
cd ~/Documents/sandbox291
ruby -ropen-uri -e 'eval open("https://git.io/vQhWq").read'
</code></pre></div></div>

<p>If successful, one should get a <code class="language-plaintext highlighter-rouge">Hooray!</code> from both Ruby versions confirming valid communication with <a href="https://rubygems.org/">Rubygems</a>, yet with their specific RubyGems and OpenSSL versions, as well as their own SSL certificates.</p>

<p>Install OpenStudio <a href="https://github.com/NREL/OpenStudio/releases/tag/v2.9.1">v2.9.1</a>.</p>

<p>Then create the file <em>~/.rbenv/versions/2.2.5/lib/ruby/site_ruby/openstudio.rb</em>, and <em>point it</em> to your OpenStudio installation by editing the contents, e.g.:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>require '/Applications/OpenStudio-2.9.1/Ruby/openstudio.rb'
</code></pre></div></div>

<p>Verify your local OpenStudio and Ruby configuration:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/Documents/sandbox291
ruby -e "require 'openstudio'" -e "puts OpenStudio::Model::Model.new"
</code></pre></div></div>

<p>Install the latest version of <em>git</em> (e.g. through Homebrew), and <code class="language-plaintext highlighter-rouge">git clone</code> the TBD measure under e.g., “sandbox291”.</p>

<p>Run the basic <a href="https://github.com/rd2/tbd#complete-list-of-test-commands">tests</a> to ensure the measure operates as expected.</p>

        </section>

        <footer>
        
          TBD is maintained by <a href="https://github.com/rd2">rd2</a><br>
        
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

      </div>
    </div>
  </body>
</html>
